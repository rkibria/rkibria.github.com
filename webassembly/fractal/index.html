<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<title>Fractal</title>
</head>

<body>

<canvas id="myCanvas" width="300" height="300" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<script>
const canvas = document.getElementById("myCanvas");

// https://stackoverflow.com/questions/4032179/how-do-i-get-the-width-and-height-of-a-html5-canvas
const SCREEN_WIDTH = canvas.scrollWidth;
const SCREEN_HEIGHT = canvas.scrollHeight;
console.log("Canvas size", SCREEN_WIDTH, "x", SCREEN_HEIGHT);

function render(imgData) {
	for (let i = 0; i < imgData.data.length; i += 4) {
		const x = (i / 4) % SCREEN_WIDTH;
		const y = SCREEN_HEIGHT - (i / (4 * SCREEN_HEIGHT));

		const color = {x: 0.2, y: 0.4, z: 0.6};
		imgData.data[i] = Math.max (0, Math.min (255, color.x * 255));
		imgData.data[i+1] = Math.max (0, Math.min (255, color.y * 255));
		imgData.data[i+2] = Math.max (0, Math.min (255, color.z * 255));
		imgData.data[i+3] = 255;
	}
}

// Get canvas bitmap
const ctx = canvas.getContext("2d");
ctx.fillStyle="black";
ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
const imgData = ctx.getImageData(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);

(function drawFrame () {
	// window.requestAnimationFrame(drawFrame, canvas);

	const t0 = performance.now();
	render (imgData);
	const t1 = performance.now();
	console.log("render time: " + (t1 - t0) + " ms");

	ctx.putImageData(imgData, 0, 0);
}());

</script>

</body>
</html>
